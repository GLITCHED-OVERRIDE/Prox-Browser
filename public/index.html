<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="Icon.png" />
<link rel="manifest" href="manifest.json"/>
<title>Glitch Hub Proxy</title>

<!-- Ultraviolet -->
<script src="/uv/bundle.js"></script>
<script src="/uv/config.js"></script>
<script>
if ("serviceWorker" in navigator") {
  navigator.serviceWorker.register("/uv/sw.js", { scope: __uv$config.prefix });
}
</script>

<style>
:root{
  --bg:#0b0f14;
  --panel:#111827;
  --panel2:#0f172a;
  --accent:#00eaff;
  --accent-soft:rgba(0,234,255,.15);
  --text:#e5e7eb;
  --muted:#9ca3af;
  --danger:#7f1d1d;
}

*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:Segoe UI,system-ui;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* TABS */
#tabsBar{
  display:flex;
  align-items:flex-end;
  gap:6px;
  padding:6px 8px;
  background:linear-gradient(to right,#0f172a,#111827);
}

.tab{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 30px 8px 12px;
  background:#1f2937;
  border-radius:10px 10px 0 0;
  cursor:pointer;
  position:relative;
  max-width:220px;
  overflow:hidden;
  transition:.2s;
}

.tab:hover{background:#263042}

.tab.active{
  background:var(--panel2);
  box-shadow:0 0 12px var(--accent-soft);
}

.tab.active::after{
  content:"";
  position:absolute;
  bottom:0;
  left:0;
  width:100%;
  height:2px;
  background:var(--accent);
}

.tab img{width:16px;height:16px}
.tab span{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tab .close{position:absolute;right:8px;color:var(--muted)}
.tab .close:hover{color:#ff4d4d}

#newTabBtn{
  padding:8px 12px;
  background:#0f172a;
  border-radius:8px;
  cursor:pointer;
  transition:.2s;
}
#newTabBtn:hover{background:#1e293b}

/* BAR */
#browserBar{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px;
  background:var(--panel);
  border-bottom:1px solid #1f2937;
}

.ctrl{
  padding:6px 10px;
  background:#0f172a;
  border:none;
  color:var(--text);
  border-radius:8px;
  cursor:pointer;
}
.ctrl:hover{
  background:var(--accent-soft);
  color:var(--accent);
}

#urlWrap{position:relative;flex:1}

#urlBar{
  width:100%;
  padding:10px 40px 10px 14px;
  background:#0f172a;
  border:1px solid #1f2937;
  border-radius:12px;
  color:var(--text);
  font-family:monospace;
}
#urlBar:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 8px var(--accent-soft);
}

#bookmarkStar{
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  font-size:18px;
  cursor:pointer;
  color:var(--muted);
}
#bookmarkStar:hover{color:var(--accent)}

#menuPanel{
  position:absolute;
  top:52px;
  right:12px;
  background:#0f172a;
  border:1px solid #1f2937;
  border-radius:12px;
  display:none;
  flex-direction:column;
  min-width:180px;
  box-shadow:0 10px 30px rgba(0,0,0,.6);
  z-index:1000;
}

#menuPanel button{
  padding:10px 14px;
  background:none;
  border:none;
  color:var(--text);
  text-align:left;
  cursor:pointer;
}
#menuPanel button:hover{
  background:var(--accent-soft);
  color:var(--accent);
}

/* BOOKMARK BAR */
#bookmarkBar{
  display:flex;
  gap:8px;
  padding:8px;
  background:#0f172a;
  border-bottom:1px solid #1f2937;
  overflow-x:auto;
}

.bookmarkButton{
  padding:6px 12px;
  background:#111827;
  border-radius:8px;
  cursor:pointer;
  font-size:.85rem;
}
.bookmarkButton:hover{
  background:var(--accent-soft);
  color:var(--accent);
}

/* CONTENT */
#frames{flex:1;position:relative;background:black}

iframe,.customPage{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:none;
  display:none;
}

iframe.active,.customPage.active{display:block}

/* MODALS */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  justify-content:center;
  align-items:center;
  backdrop-filter:blur(4px);
  z-index:2000;
}

.modalBox{
  background:#0f172a;
  padding:26px;
  border-radius:16px;
  display:flex;
  flex-direction:column;
  gap:14px;
  min-width:320px;
}

.modalBox input{
  padding:10px;
  background:#111827;
  border:1px solid #1f2937;
  border-radius:10px;
  color:var(--text);
}

.modalBox button{
  padding:8px;
  border:none;
  border-radius:10px;
  background:#1f2937;
  color:var(--text);
  cursor:pointer;
}
.modalBox button:hover{
  background:var(--accent-soft);
  color:var(--accent);
}
.deleteBtn{background:var(--danger)!important}
</style>
</head>

<body>

<div id="tabsBar">
  <div id="newTabBtn" onclick="newTab()">＋</div>
</div>

<div id="browserBar">
  <button class="ctrl" onclick="goBack()">⟵</button>
  <button class="ctrl" onclick="goForward()">⟶</button>
  <button class="ctrl" onclick="reloadTab()">⟳</button>
  <div id="urlWrap">
    <input id="urlBar" placeholder="Enter URL">
    <span id="bookmarkStar" onclick="toggleBookmark()">☆</span>
  </div>
  <button class="ctrl" onclick="fullscreen()">⛶</button>
  <button class="ctrl" id="menuBtn">⋮</button>

  <div id="menuPanel">
    <button onclick="newTab()">New Tab</button>
    <button onclick="openCustom('/?/History')">History</button>
    <button onclick="openCustom('/?/Bookmarks')">Bookmarks</button>
    <button onclick="injectDev()">Dev Tools</button>
    <button onclick="openCustom('/?/Settings')">Settings</button>
  </div>
</div>

<div id="bookmarkBar"></div>
<div id="frames"></div>

<script>
const frames=document.getElementById("frames");
const urlBar=document.getElementById("urlBar");
let tabs=[],active=null;

let defaultBrowser="Startpage";
const browserSearchURLs={
  "Startpage":"https://www.startpage.com/sp/search?q="
};

function normalize(v){
  if(!v.includes(".")) return browserSearchURLs[defaultBrowser]+encodeURIComponent(v);
  if(!v.startsWith("http")) return "https://"+v;
  return v;
}

function newTab(url){
  if(!url) url=browserSearchURLs[defaultBrowser];
  const iframe=document.createElement("iframe");
  frames.appendChild(iframe);

  const tab=document.createElement("div");
  tab.className="tab";
  tab.innerHTML=`<img><span>New Tab</span><span class="close">✕</span>`;
  document.getElementById("tabsBar").insertBefore(tab,newTabBtn);

  const t={iframe,tab,url};
  tabs.push(t);

  tab.onclick=()=>activate(t);
  tab.querySelector(".close").onclick=e=>{e.stopPropagation();closeTab(t)};

  iframe.src=__uv$config.prefix+__uv$config.encodeUrl(url);
  activate(t);
}

function activate(t){
  tabs.forEach(x=>{
    x.tab.classList.remove("active");
    x.iframe.classList.remove("active");
  });
  active=t;
  t.tab.classList.add("active");
  t.iframe.classList.add("active");
}

urlBar.onkeydown=e=>{
  if(e.key!=="Enter")return;
  const v=normalize(urlBar.value);
  active.iframe.src=__uv$config.prefix+__uv$config.encodeUrl(v);
};

function goBack(){active?.iframe.contentWindow.history.back()}
function goForward(){active?.iframe.contentWindow.history.forward()}
function reloadTab(){active?.iframe.contentWindow.location.reload()}
function fullscreen(){active?.iframe.requestFullscreen()}

function closeTab(t){
  t.tab.remove();
  t.iframe.remove();
  tabs=tabs.filter(x=>x!==t);
  tabs.length?activate(tabs.at(-1)):newTab();
}

window.onload=()=>{newTab(browserSearchURLs[defaultBrowser])}
</script>
</body>
</html>
